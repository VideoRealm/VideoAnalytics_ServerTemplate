# VideoAnalytics_ServerTemplate
Analytics-running server template code for a [ultimately censored] app - just another bit of trash on Github      

### Шаблон ПО обработки и анализа видеопотока (контроллера сервера аналитики) 
### Функции
1.	Получение и аналитическая обработка потоков с камер путём выполнения специализированных аналитических алгоритмов;
2.	Извлечение и сохранение в БД метаданных, связанных с входными потоками; 
3.	Формирование и сохранение в БД записей, фиксирующих значимые события в потоке данных, поступающих с камер;
4.	Выдача потока в реальном времени по запросу медиасервера (с достижением  чёткости видеоизображения, установленной конкретным пользователем в рамках набора доступных опций).

#### Компоненты ПО в структуре интерфейсов прямого взаимодействия:
- медиасервер;
- видеокамера;
- БД записей (с видеокамер).

Рис. 1. Схема генерации и передачи видеопотока в реальном времени (live stream).
<p align="center">
   <img src="https://user-images.githubusercontent.com/55311053/80383614-19f93d00-88a4-11ea-9b00-16620c020dd8.jpg" />
</p>

<em>Пояснения к визуализации</em>
1.	Пользователь выбирает интересующую (предварительно добавленную в персональный или сформированный по умолчанию список) камеру и запрашивает показ видео нажатием специальной кнопки на панели управления;
2.	HTTP-запрос GET передаётся на медиасервер и принимается к выполнению;
3.	Медиасервер направляет запрос на сервер диспетчеризации для получения информации о сервере обработки, на который ранее был переведён поток, переданный с выбранной пользователем камеры;
4.	Медиасервер, используя информацию от диспетчера, обращается к назначенному серверу обработки с запросом на выдачу потока;
5.	Назначенный сервер использует информацию о сетевом адресе камеры (с подключением по протоколу IP) и напрямую запрашивает передачу данных с устройства;
6.	Камера определяет наличие запроса и направляет первичный поток на сервер обработки;
7.	Сервер обработки ретранслирует первичный или подвергнутый аналитической оценке содержимого (т.е. поддерживающий отображение визуальных атрибутов анализа) поток на медиасервер; 
8.	Медиасервер преобразует исходный протокол передачи (RTSP), устанавливает соответствие размеру области отображения в браузере и направляет поток на терминал пользователя в рамках обмена видеоданными по протоколу HLS;
9.	Полученный видеопоток воспроизводится в диалоговом окне клиентского приложения (с поддержкой индивидуального выбора параметров качества воспроизведения).  

Рис. 2. Схема определения базовых классов (not match, but tribute to UML class diagram).
<p align="center">
   <img src="https://user-images.githubusercontent.com/55311053/80946282-f7a87780-8ded-11ea-9d7c-c387ed914283.jpg" />
</p>

Рис. 3. Схема определения программных интерфейсов.
<p align="center">
   <img src="https://user-images.githubusercontent.com/55311053/80946323-1444af80-8dee-11ea-8e29-5bffa729b1ec.jpg" />
</p>

Таблица 1. Состав и назначение функций API контроллера.
| Функция | Назначение|
|---|---|
| videoCapture | получение видеопотока с выбранной камеры наблюдения |
| attachAnalytics | запуск процедуры обработки потока на основе функции (комплекса функций) видеоаналитики |
| detachAnalytics | завершение аналитической обработки потока |
| startRecording | начало записи видеофрагмента |
| stopRecording | окончание записи видеофрагмента |
| compileRecord | формирование записи как объекта обмена данными с БД |
| manageQuality | регулирование характеристик потока, определяющих качество воспроизведения на стороне клиента  |
<p></p>
<strong>Проработка технологического стека</strong> 
<ul>
  <li>Язык разработки: Python 3.7</li>
  <li>Фреймворк адаптированной веб-разработки: Flask 1.1.2</li>
  <li>Библиотека функций обработки и анализа видео: OpenCV 3</li>
  <li>СУБД: PostgreSQL 12</li>
</ul>  
<br/>
Факторы оптимальности текущей структуры стека:<br/>
<ul>
  <li>универсальная модульная поддержка элементов OpenCV в Python/Flask;</li>
  <li>минимальные временные издержки для настройки OpenCV в Python/Flask;</li> 
  <li>удобство, доступность представления справочной информации и высокая скорость разработки на Python;</li> 
  <li>практичность структуры проекта и высокая динамика развёртывания сервисов веб-приложений в Flask;</li>
  <li>широкий набор тематически идентичных проектов на Python для форсированного освоения актуальных технологий;</li>
  <li>высокая производительность обработки SQL-запросов в PostgreSQL, в т.ч. в условиях интенсивного конкурентного проведения CRUD-транзакций;</li> 
  <li>практичность и гибкость конфигурирования БД в PostgreSQL (особо отмечаются визуальное и утилитарное исполнение интерфейса администрирования pgAdmin).</li>
</ul>
